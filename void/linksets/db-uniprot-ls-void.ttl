@prefix : <#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix pav: <http://purl.org/pav/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix dctypes: <http://purl.org/dc/dcmitype/> .
@prefix void: <http://rdfs.org/ns/void#> .
@prefix dul: <http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix prov: <http://www.w3.org/ns/prov#> .

<> a void:DatasetDescription ;
	dcterms:title "DrugBank-Uniprot VoID Description"@en ;
	dcterms:description "The VoID Description for a DrugBank-Uniprot linkset."@en ;
	pav:createdBy <http://orcid.org/0000-0002-1303-2189> ;
	pav:contributedBy <http://orcid.org/0000-0001-9842-9718> ;
	pav:createdOn "2015-08-19T17:02:00+01:00"^^xsd:dateTime ;
	foaf:primaryTopic :DrugBank-Uniprot .

<https://raw.github.com/openphacts/ops-platform-setup/master/void/drugbank/drugbank_4.1_void.ttl> void:subset :DrugBank-Uniprot .

:DrugBank-Uniprot a void:Linkset ;
	void:linkPredicate skos:exactMatch ;
	dcterms:title "DrugBank-Uniprot Linkset"@en ;
	dcterms:license <http://creativecommons.org/licenses/by-nd/3.0/> ;
	pav:createdBy <http://orcid.org/0000-0001-9842-9718> ;
	pav:contributedBy <http://orcid.org/0000-0002-1303-2189> ;
	pav:createdOn "2015-08-19T16:46:10+01:00"^^xsd:dateTime ;
	dul:expresses <http://semanticscience.org/resource/010043> ;
	pav:version "4.1.1"; 
	dcterms:description """Linkset relating DrugBank target entries to Uniprot, generated by querying DrugBank (v4.1). 
Excludes protein groups (which have more than 1 molecular weight).""" ;
	pav:retrievedBy <http://orcid.org/0000-0001-9842-9718> ;
	pav:derivedFrom <http://data.openphacts.org/1.5/rdf/drugbank.tar.xz> ;
	prov:wasInfluencedBy <http://data.openphacts.org/1.5/rdf/uniprot.tar.xz> ;
	pav:createdWith :drugbank-uniprot-query, <http://heater.cs.man.ac.uk:3003/sparql> ;
	void:subjectsTarget <http://raw.githubusercontent.com/openphacts/ops-platform-setup/1.5.0/void/drugbank_4.1_void.ttl#drugbank-rdf> ;
	void:objectsTarget <https://github.com/openphacts/ops-platform-setup/raw/1.5.0/void/uniprot_2015_01_void.ttl#uniprotkb_rdf> ;
	void:triples "3575"^^xsd:integer .


:drugbank-uniprot-query dcterms:title "DrugBank - UniProt linkset generation SPARQL query" ;
	dcterms:description """
PREFIX db: <http://bio2rdf.org/drugbank_vocabulary:>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX uniprot: <http://purl.uniprot.org/core/>
PREFIX drugbank: <http://bio2rdf.org/drugbank_vocabulary:>

CONSTRUCT {
  ?target skos:exactMatch ?uniprot .
}
WHERE {

      GRAPH <http://www.openphacts.org/bio2rdf/drugbank> {
      [] db:target ?target .
      ?target db:x-uniprot ?uniprot .

      OPTIONAL {
      {  SELECT ?target (COUNT(?molweight) AS ?molweightCount) 
         WHERE {    
           ?target drugbank:molecular-weight ?molweight .
         } 
         GROUP BY ?target
      }
      }
  }
  GRAPH <http://purl.uniprot.org> {
    ?uniprot a uniprot:Protein .
  }
  FILTER ( !( bound(?molweightCount)) || ?molweightCount = 1  )
}
""";
	dcterms:license <http://www.apache.org/licenses/LICENSE-2.0> .
